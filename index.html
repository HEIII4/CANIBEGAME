<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAN I BE</title>
    <style>
        /* --- GLOBAL STYLES --- */
        :root {
            --primary: #9730cf; /* Default Purple */
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
        }

        /* Mode Colors */
        body.mode-anime { --primary: #a474d4; } /* Purple */
        body.mode-lol { --primary: #0bc6e3; } /* Hextech Blue */
        body.mode-football { --primary: #2ecc71; } /* Grass Green */

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.5s;
        }

        /* --- TOP BAR --- */
        .top-bar {
            background-color: #1a1a1a;
            padding: 15px 20px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; color: var(--primary); font-size: 24px; text-transform: uppercase; letter-spacing: 1px; }

        .controls-wrapper { display: flex; gap: 20px; align-items: center; }
        .control-group { display: flex; gap: 8px; align-items: center; }

        /* INPUTS & SELECTS */
        select, input {
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #444;
            background: #2a2a2a;
            color: white;
            outline: none;
            font-size: 14px;
        }
        select { font-weight: bold; cursor: pointer; border-color: var(--primary); }
        input:focus { border-color: var(--primary); }

        /* BUTTONS */
        button {
            padding: 10px 18px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background-color: #333;
            color: white;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.2s;
            border: 1px solid #555;
        }
        button:hover { background-color: var(--primary); color: black; border-color: var(--primary); }
        
        .add-player-btn { background-color: #27ae60; border: none; }
        .add-player-btn:hover { background-color: #2ecc71; }

        .search-btn { background-color: var(--primary); color: black; border: none; }
        .search-btn:hover { filter: brightness(1.1); }

        .custom-btn { background-color: transparent; border: 1px dashed #777; color: #aaa; }
        .custom-btn:hover { border-color: white; color: white; background: transparent; }

        /* --- SEARCH RESULTS --- */
        .selection-row {
            background-color: #161616;
            padding: 10px;
            height: 180px;
            display: flex;
            justify-content: center;
            gap: 15px;
            overflow-x: auto;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
            align-items: center;
        }

        .instruction-text { color: #666; font-style: italic; }

        .draggable-card {
            background: #000;
            width: 100px;
            height: 145px;
            border-radius: 8px;
            cursor: grab;
            border: 2px solid transparent;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            transition: transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .draggable-card:active { cursor: grabbing; }
        .draggable-card:hover { transform: scale(1.05); border-color: var(--primary); }

        .draggable-card img {
            width: 100%;
            height: 100%;
            /* FIX: Cover fills the box. Top aligns to faces. */
            object-fit: cover; 
            object-position: top center; 
        }

        .search-name-overlay {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, black, transparent);
            color: white;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            padding: 15px 2px 5px 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 1px 2px black;
        }

        /* --- MAIN GAME BOARD --- */
        .board-container {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            background-color: #0d0d0d;
            overflow-x: auto;
            justify-content: center;
        }

        .player-column {
            flex: 1;
            min-width: 320px;
            max-width: 600px;
            background-color: #1a1a1a;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
            transition: all 0.3s;
        }

        .drag-hover { background-color: #222; border: 2px dashed var(--primary); }

        .column-header {
            background-color: #252525;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
            border-radius: 10px 10px 0 0;
            border-bottom: 3px solid var(--primary);
        }

        .player-column.player-done { border: 2px solid #2ecc71; background-color: #112211; }
        .player-column.player-done .column-header { background-color: #2ecc71; color: black; border-bottom: none; }

        .header-btn-group { display: flex; gap: 5px; }
        .small-btn { font-size: 11px; padding: 5px 10px; border-radius: 4px; cursor: pointer; border: none; }
        .btn-done { background-color: #444; color: white; }
        .player-done .btn-done { background-color: white; color: black; font-weight: bold; }
        .btn-del { background-color: #e74c3c; color: white; }

        .column-content {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            align-content: start;
        }

        /* --- GAME TILES (Final Fix) --- */
        .game-tile {
            position: relative;
            aspect-ratio: 1 / 1.4; /* Taller card style */
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.6);
            border: 1px solid #444;
            cursor: pointer;
            animation: popIn 0.2s;
        }

        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* The Image Logic */
        .game-tile img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            object-position: top center; /* Prevents half-head */
            transition: opacity 0.2s;
        }

        /* X Button Centered */
        .remove-tile-btn {
            position: absolute;
            top: 5px; right: 5px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            width: 24px; height: 24px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tile-overlay {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.85);
            color: var(--primary);
            font-size: 11px;
            text-align: center;
            padding: 5px 2px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            font-weight: bold;
        }

        .game-tile:hover .tile-overlay { opacity: 1; }
        .game-tile:hover .remove-tile-btn { opacity: 1; }
        .game-tile:hover img { opacity: 0.6; }

    </style>
</head>
<body class="mode-anime">

    <div class="top-bar">
        <h1>Guess The Category</h1>
        
        <div class="controls-wrapper">
            <!-- Mode Selector -->
            <div class="control-group">
                <select id="gameMode" onchange="changeMode()">
                    <option value="anime">Anime Mode</option>
                    <option value="lol">League Mode</option>
                    <option value="football">Football Mode</option>
                </select>
            </div>

            <div class="control-group">
                <input type="text" id="newPlayerName" placeholder="Player Name" style="width: 120px;">
                <button onclick="addPlayer()" class="add-player-btn">+</button>
            </div>

            <div class="control-group">
                <input type="text" id="characterInput" placeholder="Search..." autocomplete="off">
                <button onclick="performSearch()" class="search-btn">Search</button>
                <button onclick="addCustomImage()" class="custom-btn" title="Add Image by URL">Custom</button>
            </div>
        </div>
    </div>

    <!-- Search Results -->
    <div id="selectionArea" class="selection-row">
        <p class="instruction-text">Select a mode and search for a character.</p>
    </div>

    <!-- Main Game Board -->
    <div id="gameBoard" class="board-container"></div>

    <script>
        // --- JAVASCRIPT LOGIC ---
        
        let players = [];
        let playerIdCounter = 0;
        let lolChampions = [];

        const input = document.getElementById('characterInput');
        const selectionArea = document.getElementById('selectionArea');
        const gameBoard = document.getElementById('gameBoard');
        const modeSelect = document.getElementById('gameMode');

        // 1. INITIAL SETUP
        window.onload = async () => {
            addPlayer("Me");
            await fetchLoLData(); // Pre-load LoL data
        };

        // Fetch League of Legends Data
        async function fetchLoLData() {
            try {
                const versionResp = await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
                const versions = await versionResp.json();
                const latest = versions[0];
                const champResp = await fetch(`https://ddragon.leagueoflegends.com/cdn/${latest}/data/en_US/champion.json`);
                const champData = await champResp.json();
                lolChampions = Object.values(champData.data);
            } catch (e) { console.error("LoL Data Error", e); }
        }

        // Change Styling based on Mode
        function changeMode() {
            document.body.className = `mode-${modeSelect.value}`;
            input.placeholder = modeSelect.value === 'anime' ? "Search Anime..." : 
                               modeSelect.value === 'lol' ? "Search Champion..." : 
                               "Search Footballer...";
            selectionArea.innerHTML = '';
        }

        input.addEventListener("keypress", (e) => { if (e.key === "Enter") performSearch(); });
        document.getElementById('newPlayerName').addEventListener("keypress", (e) => { if (e.key === "Enter") addPlayer(); });

        // --- PLAYER FUNCTIONS ---
        function addPlayer(nameOverride) {
            const nameInput = document.getElementById('newPlayerName');
            const name = nameOverride || nameInput.value.trim();
            if (!name) return;
            players.push({ id: playerIdCounter++, name, isDone: false, cards: [] });
            renderBoard();
            nameInput.value = '';
        }

        function removePlayer(id) {
            if(confirm("Delete this player?")) {
                players = players.filter(p => p.id !== id);
                renderBoard();
            }
        }

        function toggleDone(id) {
            const player = players.find(p => p.id === id);
            if (player) { player.isDone = !player.isDone; renderBoard(); }
        }

        function deleteCard(playerId, cardIndex) {
            const player = players.find(p => p.id === playerId);
            if (player) { player.cards.splice(cardIndex, 1); renderBoard(); }
        }

        // --- RENDER BOARD ---
        function renderBoard() {
            gameBoard.innerHTML = '';
            players.forEach(player => {
                const col = document.createElement('div');
                col.className = `player-column ${player.isDone ? 'player-done' : ''}`;
                col.ondragover = (e) => { e.preventDefault(); col.classList.add('drag-hover'); };
                col.ondragleave = () => col.classList.remove('drag-hover');
                col.ondrop = (e) => handleDrop(e, player.id);

                let cardsHTML = '';
                player.cards.forEach((card, index) => {
                    cardsHTML += `
                        <div class="game-tile" title="${card.name}">
                            <button class="remove-tile-btn" onclick="deleteCard(${player.id}, ${index})">×</button>
                            <img src="${card.image}" alt="${card.name}">
                            <div class="tile-overlay">${card.name}</div>
                        </div>
                    `;
                });

                col.innerHTML = `
                    <div class="column-header">
                        <span>${player.name}</span>
                        <div class="header-btn-group">
                            <button class="small-btn btn-done" onclick="toggleDone(${player.id})">
                                ${player.isDone ? 'DONE' : 'Mark Done'}
                            </button>
                            <button class="small-btn btn-del" onclick="removePlayer(${player.id})">×</button>
                        </div>
                    </div>
                    <div class="column-content" id="col-${player.id}">${cardsHTML}</div>
                `;
                gameBoard.appendChild(col);
            });
        }

        // --- SEARCH ROUTER ---
        async function performSearch() {
            const query = input.value.trim();
            if (!query) return;
            const mode = modeSelect.value;
            selectionArea.innerHTML = '<p class="instruction-text">Searching...</p>';

            if (mode === 'anime') await searchAnime(query);
            else if (mode === 'lol') searchLoL(query);
            else if (mode === 'football') await searchFootball(query);
        }

        // 1. ANIME SEARCH (Anilist)
        async function searchAnime(query) {
            // Updated to fetch 12 results so Sentomaru shows up
            const queryGraphQL = `
            query ($search: String) {
              Page(perPage: 12) {
                characters(search: $search, sort: FAVOURITES_DESC) {
                  name { userPreferred }
                  image { large }
                }
              }
            }
            `;
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: queryGraphQL, variables: { search: query } })
                });
                const data = await response.json();
                displayResults(data.data.Page.characters.map(c => ({
                    name: c.name.userPreferred,
                    image: c.image.large
                })));
            } catch (e) { selectionArea.innerHTML = 'Error searching Anime.'; }
        }

        // 2. LOL SEARCH (Local Data)
        function searchLoL(query) {
            const q = query.toLowerCase();
            const matches = lolChampions.filter(c => c.name.toLowerCase().includes(q) || c.id.toLowerCase().includes(q));
            
            if(matches.length === 0) {
                selectionArea.innerHTML = '<p class="instruction-text">No Champion found. Use "Custom" for Rhaast/Skins.</p>';
                return;
            }

            displayResults(matches.map(c => ({
                name: c.name,
                // Official high-res loading screen art
                image: `http://ddragon.leagueoflegends.com/cdn/img/champion/loading/${c.id}_0.jpg`
            })));
        }

        // 3. FOOTBALL SEARCH (Wikipedia)
        async function searchFootball(query) {
            // Wikipedia API for Thumbnail images
            const url = `https://en.wikipedia.org/w/api.php?action=query&generator=prefixsearch&gpssearch=${encodeURIComponent(query)}&prop=pageimages&piprop=thumbnail&pithumbsize=400&format=json&origin=*`;
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                
                if (!data.query || !data.query.pages) {
                    selectionArea.innerHTML = '<p class="instruction-text">No player found on Wikipedia.</p>';
                    return;
                }

                const pages = Object.values(data.query.pages);
                // Filter only pages that have images
                const validPages = pages.filter(p => p.thumbnail);

                displayResults(validPages.map(p => ({
                    name: p.title,
                    image: p.thumbnail.source
                })));

            } catch (e) { selectionArea.innerHTML = 'Error searching Wikipedia.'; }
        }

        // HELPER: Display Cards
        function displayResults(items) {
            selectionArea.innerHTML = '';
            if (items.length === 0) {
                selectionArea.innerHTML = '<p class="instruction-text">No results found.</p>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'draggable-card';
                card.draggable = true;
                
                card.ondragstart = (e) => {
                    const charData = JSON.stringify({ name: item.name, image: item.image });
                    e.dataTransfer.setData("application/json", charData);
                };

                card.innerHTML = `
                    <img src="${item.image}">
                    <div class="search-name-overlay">${item.name}</div>
                `;
                selectionArea.appendChild(card);
            });
        }

        // CUSTOM IMAGE
        function addCustomImage() {
            const url = prompt("Paste Image URL (Right click image -> Copy Image Address):");
            if (!url) return;
            const name = prompt("Enter Name:");
            if (!name) return;

            selectionArea.innerHTML = '';
            const card = document.createElement('div');
            card.className = 'draggable-card';
            card.draggable = true;
            card.ondragstart = (e) => {
                e.dataTransfer.setData("application/json", JSON.stringify({ name, image: url }));
            };
            card.innerHTML = `<img src="${url}"><div class="search-name-overlay">${name}</div>`;
            selectionArea.appendChild(card);
        }

        // HANDLE DROP
        function handleDrop(e, playerId) {
            e.preventDefault();
            document.querySelectorAll('.player-column').forEach(c => c.classList.remove('drag-hover'));
            const data = e.dataTransfer.getData("application/json");
            if (!data) return;
            const char = JSON.parse(data);
            const player = players.find(p => p.id === playerId);
            if (player) { player.cards.unshift(char); renderBoard(); }
        }
    </script>
</body>
</html>